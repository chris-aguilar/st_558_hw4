[
  {
    "objectID": "st_558_hw4.html",
    "href": "st_558_hw4.html",
    "title": "ST558 HW4: Advanced Functions, API Calls",
    "section": "",
    "text": "This assignment covers Summer 2024’s ST 558 HW4. We’ll cover some conceptual questions about R, some more function writing, and some API calls."
  },
  {
    "objectID": "st_558_hw4.html#introduction",
    "href": "st_558_hw4.html#introduction",
    "title": "ST558 HW4: Advanced Functions, API Calls",
    "section": "",
    "text": "This assignment covers Summer 2024’s ST 558 HW4. We’ll cover some conceptual questions about R, some more function writing, and some API calls."
  },
  {
    "objectID": "st_558_hw4.html#task-1-conceptual-questions",
    "href": "st_558_hw4.html#task-1-conceptual-questions",
    "title": "ST558 HW4: Advanced Functions, API Calls",
    "section": "Task 1: Conceptual Questions",
    "text": "Task 1: Conceptual Questions\n\nWhat is the purpose of the lapply() function? What is the equivalent purrr function?\n\n\nThe purpose of lapply() is to keep us from explicitly writing for-loops that return a list of results. The purrr equivalent is map.\n\n\nSuppose we have a list called my_list. Each element of the list is a numeric data frame (all columns are numeric). We want use lapply() to run the code cor(numeric_matrix, method = “kendall”) on each element of the list. Write code to do this below!\n\n\nlapply(my_list, cor, method = \"kendall\")\n\n\nWhat are two advantages of using purrr functions instead of the BaseR apply family?\n\n\nThe two advantages are consistency between purrr functions (the function arguments are consistently named, preventing confusion, and the outputs are predictable from the function name) and the availability of additional helper functions within the map functions, allowing more compact code. For example, ~ . + 1 is equivalent to function(x) x + 1.\n\n\nWhat is a side effect function?\n\n\nA side effect function is a function that doesn’t transform its input into something else, but instead performs another action, like writing to disk or plotting something. So the input remains unchanged.\n\n\nWhy can you name a variable sd in a function and not cause any issues with the sd function?\n\n\nAny time you create a function and run it, it creates a temporary environment for the function. This temporary environment is what the function uses to look for variables by default before looking outside this environment. So a variable defined inside this temporary environment doesn’t overwrite anything outside, and the temporary environment disappears once the function is done running."
  },
  {
    "objectID": "st_558_hw4.html#task-2-writing-r-functions",
    "href": "st_558_hw4.html#task-2-writing-r-functions",
    "title": "ST558 HW4: Advanced Functions, API Calls",
    "section": "Task 2: Writing R Functions",
    "text": "Task 2: Writing R Functions\nWe’ll now write some common machine learning evaluation metric functions.\n\nRMSE\n\nStep 1\nFirst, Root Mean Squared Error (RMSE). This function will take a vector of responses and a vector of predictions, and will be able to handle missing values.\n\ngetRMSE &lt;- function(responses, predictions, ...) {\n  \n  # squaring the difference between response and prediction\n  sq_err &lt;- (responses - predictions)^2\n  \n  # mean squared error, and allowing for additional arguments\n  mse &lt;- mean(sq_err, ...)\n  \n  # RMSE\n  sqrt(mse)\n}\n\n\n\nStep 2\nLet’s test our getRMSE function. We’ll create some toy data to do this, then run our function.\n\n# generating data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10*x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n# testing RMSE function\ngetRMSE(resp, pred)\n\n[1] 0.9581677\n\n\nNow, we’ll test how our function handles NA values. First we’ll add two NA values to our responses. Then we’ll run our function with and without accounting for NA values.\n\n# NA to elements 1 and 3\nresp[c(1, 3)] &lt;- NA_real_\n\n# test, no account for NAs\ngetRMSE(resp, pred) # returns NA\n\n[1] NA\n\n# account for NAs\ngetRMSE(resp, pred, na.rm = TRUE)\n\n[1] 0.9573308\n\n\nOur getRMSE function works as intended.\n\n\n\nMAE\n\nStep 3\nNow let’s look at another common metric, mean absolute deviation (MAE). We’ll follow the same approach as above, with a few minor changes to the mathematical steps.\n\ngetMAE &lt;- function(responses, predictions, ...) {\n  \n  # absolute difference between response and prediction\n  abs_err &lt;- abs(responses - predictions)\n  \n  # RMSE\n  mean(abs_err, ...)\n}\n\n\n\nStep 4\nAs before, we’ll create some toy data, test getMAE, replace two values in our responses with NA_real_, then check that our function can handle missing values with the na.rm argument passed to mean under the hood.\nFirst, generate data and check that getMAE() works.\n\n# toy data\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10*x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n# testing getMAE\ngetMAE(resp, pred)\n\n[1] 0.8155776\n\n\nNow we introduce missing values and show that getMAE can handle them.\n\n# NA to elements 1 and 3\nresp[c(1, 3)] &lt;- NA_real_\n\n# test getMAE, no account for NAs\ngetMAE(resp, pred)\n\n[1] NA\n\n# account for NAs\ngetMAE(resp, pred, na.rm = TRUE)\n\n[1] 0.8138154\n\n\n\n\n\nWrapper function\n\nStep 5\nWe write a wrapper function using our MAE and RMSE helper functions above. We want it to return either or both metrics, with the outputs given appropriate names.\nWe should check our inputs are two numeric vectors, and by default, our function should return both MAE and RMSE.\n\ngetMetrics &lt;- function(resp, pred, metric = \"both\", ...) {\n  \n  # input checks: first checking atomic, then vector, and finally, numeric\n  if(!(is.vector(resp) & is.vector(pred))) stop(\"resp and pred should both be vectors\")\n  if(!(is.atomic(resp) & is.atomic(pred))) stop(\"resp and pred should both be atomic vectors\")\n  if(!(is.numeric(resp) & is.numeric(pred))) stop(\"resp and pred should both be numeric\")\n  \n  \n  # one more check to make sure our metric string is correct\n  if(!(metric %in% c(\"both\", \"RMSE\", \"MAE\"))) stop (\"metric should be one of 'both', 'RMSE', 'MAE'\")\n  \n  # checking for metric and giving results appropriately\n  if(metric == \"both\") {\n    \n    res &lt;- c(getRMSE(resp, pred, ...), getMAE(resp, pred, ...))\n    names(res) &lt;- c(\"RMSE\", \"MAE\")\n    \n  } else if(metric == \"RMSE\") {\n    \n    res &lt;- getRMSE(resp, pred, ...)\n    names(res) &lt;- \"RMSE\"\n    \n  } else {\n    res &lt;- getMAE(resp, pred, ...)\n    names(res) &lt;- \"MAE\"\n  }\n  \n  # returning result\n  res\n}\n\n\n\nStep 6\nWe now test our getMetrics function.\nFirst, toy data, then we call it for each metric individually, then both.\n\nset.seed(10)\nn &lt;- 100\nx &lt;- runif(n)\nresp &lt;- 3 + 10*x + rnorm(n)\npred &lt;- predict(lm(resp ~ x), data.frame(x))\n\n# RMSE\ngetMetrics(resp, pred, metric = \"RMSE\")\n\n     RMSE \n0.9581677 \n\n# MAE\ngetMetrics(resp, pred, metric = \"MAE\")\n\n      MAE \n0.8155776 \n\n# both\ngetMetrics(resp, pred, metric = \"both\")\n\n     RMSE       MAE \n0.9581677 0.8155776 \n\n\nOur function works so far.\nNow, let’s put in two NA values and ensure we can handle them in our function.\n\n# NA to elements 1 and 3\nresp[c(1, 3)] &lt;- NA_real_\n\n# No NA accounting for\ngetMetrics(resp, pred)\n\nRMSE  MAE \n  NA   NA \n\n# Account for NA\ngetMetrics(resp, pred, na.rm = TRUE)\n\n     RMSE       MAE \n0.9573308 0.8138154 \n\n\nLastly, let’s check that our function can check input types correctly. Also, because I’m a little OCD, I also include a check to ensure the metric argument is one of “both”, “RMSE”, “MAE”.\n\n# non-numeric input\ntry(getMetrics(resp, \"a\"))\n\nError in getMetrics(resp, \"a\") : resp and pred should both be numeric\n\n# non-atomic input\ntry(getMetrics(resp, list(pred)))\n\nError in getMetrics(resp, list(pred)) : \n  resp and pred should both be atomic vectors\n\n# non-vector input\ntry(getMetrics(resp, iris))\n\nError in getMetrics(resp, iris) : resp and pred should both be vectors\n\n# incorrect metric specification\ntry(getMetrics(resp, pred, metric = \"foo\"))\n\nError in getMetrics(resp, pred, metric = \"foo\") : \n  metric should be one of 'both', 'RMSE', 'MAE'"
  },
  {
    "objectID": "st_558_hw4.html#task-3-api-querying-and-tidy-style-function",
    "href": "st_558_hw4.html#task-3-api-querying-and-tidy-style-function",
    "title": "ST558 HW4: Advanced Functions, API Calls",
    "section": "Task 3: API Querying and Tidy-Style Function",
    "text": "Task 3: API Querying and Tidy-Style Function\nNow we’ll connect to the News API. We’ll need to register for an API key first before we can access news content programmatically.\nWe’re first going to connect manually and ensure we can pull results. Then we’ll create a function to do so.\n\nStep 1: Manual News API Call\nWe connect manually below. My wife is a big fan of Kendrick Lamar, so to impress her, I’m going to look up some results around him.\nRather than trying to manually create the url for the search, I feed different parts of the url reverse-engineered from looking at the examples on the News API’s home page at the link above. I looked at the documentation’s examples for GET() to figure out how to do the actions below.\nNOTE: Hard-coding API keys or authentication info, also known as secrets, into our scripts is a thorough no-no. There are many strategies to use secrets, but the one I’m opting for is to put the API key in another file, source it, and ensure that file doesn’t get pushed to remote, that is, make sure it isn’t staged and committed before pushing.\n\nlibrary(httr)\n\n# probably not a best practice to hardcode API keys/authentication, so we stick the API key in another file and source it.\n\napi_key &lt;- source(\"news_api_key.R\")\n\nnews_api_return &lt;- GET(url = \"https://newsapi.org/\", \n                         path = \"v2/everything\", \n                         query = list(\n                           q = \"kendrick lamar not like us\", \n                           apiKey = api_key$value,\n                           from = '2024-06-19', \n                           sortBy = 'relevancy',\n                           language = 'en')\n  )\n\n\n\nStep 2: Parsing API Call Result\nNow we parse the result of the API call for the data we care about.\n\nlibrary(jsonlite)\nparsed_result &lt;- fromJSON(rawToChar(news_api_return$content))\nstr(parsed_result$articles)\n\n'data.frame':   100 obs. of  8 variables:\n $ source     :'data.frame':    100 obs. of  2 variables:\n  ..$ id  : chr  \"wired\" NA NA \"bleacher-report\" ...\n  ..$ name: chr  \"Wired\" \"HYPEBEAST\" \"The A.V. Club\" \"Bleacher Report\" ...\n $ author     : chr  \"Angela Watercutter\" \"info@hypebeast.com (Hypebeast)\" \"Emma Keates\" \"Scott Polacek\" ...\n $ title      : chr  \"Somehow, Concerts Are the Biggest Memes of the Summer\" \"Kendrick Lamar Brings Out 25 Artists During ‘Ken & Friends’ LA Pop-Up Show\" \"Kendrick Lamar unites the West (and the rest) with repeated Drake disses\" \"Video: LeBron, James Harden, NBA Stars Attend Kendrick Lamar Concert amid Drake Beef\" ...\n $ description: chr  \"From Chappell Roan to Kendrick Lamar, online life is spilling onto the lighted stage, and vice versa. Maybe we \"| __truncated__ \"While fans expected a special guest or two during Kendrick Lamar’s Juneteenth concert, “Ken & Friends – The Pop\"| __truncated__ \"A decade from now, people will be bragging about being in the room for Kendrick Lamar’s “The Pop Out: Ken and F\"| __truncated__ \"This might not necessarily mean LeBron James and other NBA stars have officially picked a side in the Kendrick \"| __truncated__ ...\n $ url        : chr  \"https://www.wired.com/story/somehow-concerts-are-the-biggest-memes-of-the-summer/\" \"https://hypebeast.com/2024/6/kendrick-lamar-ken-friends-pop-up-show-recap\" \"https://www.avclub.com/kendrick-lamar-not-like-us-pop-out-drake-1851550572\" \"https://bleacherreport.com/articles/10125441-video-lebron-james-harden-nba-stars-attend-kendrick-lamar-concert-amid-drake-beef\" ...\n $ urlToImage : chr  \"https://media.wired.com/photos/6674712f77415c2a81e0de0f/191:100/w_1280,c_limit/GettyImages-2158458572.jpg\" \"https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fimage%2F2024%2F06%2F20%2Fkendrick-lamar-ken-and-friends\"| __truncated__ \"https://i.kinja-img.com/image/upload/c_fill,h_675,pg_1,q_80,w_1200/441d92d3099eba1d7a5ddcbb8f312415.jpg\" \"https://media.bleacherreport.com/image/upload/c_fill,g_faces,w_3800,h_2000,q_95/v1718850125/cjsdzmijrdvayjmweihq.jpg\" ...\n $ publishedAt: chr  \"2024-06-21T11:00:00Z\" \"2024-06-20T17:02:45Z\" \"2024-06-20T15:23:00Z\" \"2024-06-20T02:24:53Z\" ...\n $ content    : chr  \"On Wednesday, Juneteenth, Kendrick Lamar threw himself a party. Dubbed the Pop Out: Ken and Friends, the concer\"| __truncated__ \"While fans expected a special guest or two during Kendrick Lamars Juneteenth concert, Ken &amp; Friends The Pop\"| __truncated__ \"A decade from now, people will be bragging about being in the room for Kendrick Lamars The Pop Out: Ken and Fri\"| __truncated__ \"Noel Vasquez/GC Images\\r\\nThis might not necessarily mean LeBron James and other NBA stars have officially pick\"| __truncated__ ...\n\n\nWe can see the manual API call works. Now let’s make a function so we can do this process repeatedly.\n\n\nStep 3: News API Call function\nFor the function, we require a topic to search on, an API key, and a starting date range for our search. But for more advanced users, we also provide the option to add more query elements to really specify what they’re looking for.\nSee here for additional parameters to pass to the query.\nWe’ll call the function a few times to verify it does what we expect.\n\nlibrary(httr)\nlibrary(jsonlite)\nlibrary(tibble)\n\napi_key &lt;- api_key &lt;- source(\"news_api_key.R\")$value\n\ngetNews &lt;- function(topic, api_key, start = NULL, ...) {\n  \n  # if no start date given, date range starts from yesterday\n  if(is.null(start)) start &lt;- Sys.Date() - 1\n  \n  query &lt;- list(q = topic, apiKey = api_key, from = start, sortBy = \"popularity\", ...)\n  \n  news_api_return &lt;- GET(url = \"https://newsapi.org/\", \n                         path = \"v2/everything\", \n                         query = query\n  )\n  \n  parsed_result &lt;- fromJSON(rawToChar(news_api_return$content))\n  \n  parsed_result$articles |&gt; tibble::as_tibble()\n}\n\ngetNews(topic = \"kendrick lamar euphoria\", api_key = api_key, start = '2024-06-01', language = 'en')\n\n# A tibble: 84 × 8\n   source$id $name author title description url   urlToImage publishedAt content\n   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 &lt;NA&gt;      Pitc… \"Matt… Kend… The show t… http… https://m… 2024-06-05… \"Kendr…\n 2 &lt;NA&gt;      The … \"Emma… Kend… A decade f… http… https://i… 2024-06-20… \"A dec…\n 3 bleacher… Blea… \"Scot… Vide… This might… http… https://m… 2024-06-20… \"Noel …\n 4 &lt;NA&gt;      Ster… \"Tom … Kend… What do yo… http… https://s… 2024-06-20… \"What …\n 5 &lt;NA&gt;      Roll… \"Mank… Dr. … “We done l… http… https://w… 2024-06-20… \"Kendr…\n 6 &lt;NA&gt;      Roll… \"Krys… Here… Dr. Dre an… http… https://w… 2024-06-20… \"In hi…\n 7 &lt;NA&gt;      NPR   \"Shel… Kend… Lamar's bl… http… https://n… 2024-06-20… \"When …\n 8 &lt;NA&gt;      Forb… \"Cono… Drak… The Drake … http… https://i… 2024-06-06… \"Drake…\n 9 &lt;NA&gt;      Forb… \"Laur… Kend… Kendrick L… http… https://i… 2024-06-20… \"Kendr…\n10 &lt;NA&gt;      Forb… \"Cono… Here… Lamar doub… http… https://i… 2024-06-20… \"Kendr…\n# ℹ 74 more rows\n\ngetNews(topic = \"san francisco 49ers\", api_key = api_key, start = '2024-06-01')\n\n# A tibble: 100 × 8\n   source$id $name author title description url   urlToImage publishedAt content\n   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;  \n 1 &lt;NA&gt;      NPR   Ayana… Larr… \"The annou… http… https://n… 2024-06-04… \"Legen…\n 2 &lt;NA&gt;      Read… Owen … Madd… \"Christian… http… https://r… 2024-06-11… \"Chris…\n 3 espn      ESPN  NFL N… From… \"Our NFL N… http… https://a… 2024-06-03… \"The 2…\n 4 espn      ESPN  &lt;NA&gt;   Sour… \"Christian… http… https://a… 2024-06-04… \"Reign…\n 5 espn      ESPN  Fanta… Mock… \"Our lates… http… https://a… 2024-06-14… \"Jun 1…\n 6 abc-news  ABC … SCHUY… Larr… \"Larry All… http… https://i… 2024-06-03… \"DALLA…\n 7 &lt;NA&gt;      Game… Mark … Madd… \"The cover… http… https://w… 2024-06-11… \"The c…\n 8 &lt;NA&gt;      HYPE… info@… 49er… \"EA Sports… http… https://i… 2024-06-11… \"EA Sp…\n 9 &lt;NA&gt;      HYPE… info@… Take… \"Just last… http… https://i… 2024-06-14… \"Just …\n10 bleacher… Blea… Adam … 49er… \"The start… http… https://m… 2024-06-05… \"Perry…\n# ℹ 90 more rows\n\n\nOur News API function call works!"
  }
]